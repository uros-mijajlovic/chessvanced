(()=>{"use strict";var t,e,r,n,s={618:(t,e,r)=>{r.d(e,{qQ:()=>k});const n="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",s=["1-0","0-1","1/2-1/2","*"],a={b:[16,32,17,15],w:[-16,-32,-17,-15]},i={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},o=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],l=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],c={p:0,n:1,b:2,r:3,q:4,k:5},h={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},u={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},d={w:[{square:u.a1,flag:h.QSIDE_CASTLE},{square:u.h1,flag:h.KSIDE_CASTLE}],b:[{square:u.a8,flag:h.QSIDE_CASTLE},{square:u.h8,flag:h.KSIDE_CASTLE}]};function f(t){var e=t.charAt(0);if(e>="a"&&e<="h"){if(t.match(/[a-h]\d.*[a-h]\d/))return;return P}return"o"===(e=e.toLowerCase())?w:e}function p(t){return t.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function v(t){return t>>4}function g(t){return 15&t}function m(t){var e=g(t),r=v(t);return"abcdefgh".substring(e,e+1)+"87654321".substring(r,r+1)}function y(t){return t===C?A:C}function b(t){var e=t instanceof Array?[]:{};for(var r in t)e[r]="object"==typeof r?b(t[r]):t[r];return e}function E(t){return t.replace(/^\s+|\s+$/g,"")}const A="b",C="w",O=-1,P="p",_="b",w="k",M=(function(){for(var t=[],e=u.a8;e<=u.h1;e++)136&e?e+=7:t.push(m(e))}(),{NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"}),k=function(t){var e=new Array(128),r={w:O,b:O},k=C,T={w:0,b:0},I=O,S=0,R=1,L=[],D={},B={};function N(t){void 0===t&&(t=!1),e=new Array(128),r={w:O,b:O},k=C,T={w:0,b:0},I=O,S=0,R=1,L=[],t||(D={}),B={},Q(U())}function F(){for(var t=[],e={},r=function(t){t in B&&(e[t]=B[t])};L.length>0;)t.push(nt());for(r(U());t.length>0;)rt(t.pop()),r(U());B=e}function x(){q(n)}function q(t,e){void 0===e&&(e=!1);var r=t.split(/\s+/),n=r[0],s=0;if(!V(t).valid)return!1;N(e);for(var a=0;a<n.length;a++){var i=n.charAt(a);if("/"===i)s+=8;else if(-1!=="0123456789".indexOf(i))s+=parseInt(i,10);else{var o=i<"a"?C:A;K({type:i.toLowerCase(),color:o},m(s)),s++}}return k=r[1],r[2].indexOf("K")>-1&&(T.w|=h.KSIDE_CASTLE),r[2].indexOf("Q")>-1&&(T.w|=h.QSIDE_CASTLE),r[2].indexOf("k")>-1&&(T.b|=h.KSIDE_CASTLE),r[2].indexOf("q")>-1&&(T.b|=h.QSIDE_CASTLE),I="-"===r[3]?O:u[r[3]],S=parseInt(r[4],10),R=parseInt(r[5],10),Q(U()),!0}function V(t){var e=t.split(/\s+/);if(6!==e.length)return{valid:!1,error_number:1,error:"FEN string must contain six space-delimited fields."};if(isNaN(parseInt(e[5]))||parseInt(e[5],10)<=0)return{valid:!1,error_number:2,error:"6th field (move number) must be a positive integer."};if(isNaN(parseInt(e[4]))||parseInt(e[4],10)<0)return{valid:!1,error_number:3,error:"5th field (half move counter) must be a non-negative integer."};if(!/^(-|[abcdefgh][36])$/.test(e[3]))return{valid:!1,error_number:4,error:"4th field (en-passant square) is invalid."};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(e[2]))return{valid:!1,error_number:5,error:"3rd field (castling availability) is invalid."};if(!/^(w|b)$/.test(e[1]))return{valid:!1,error_number:6,error:"2nd field (side to move) is invalid."};var r=e[0].split("/");if(8!==r.length)return{valid:!1,error_number:7,error:"1st field (piece positions) does not contain 8 '/'-delimited rows."};for(var n=0;n<r.length;n++){for(var s=0,a=!1,i=0;i<r[n].length;i++)if(isNaN(r[n][i])){if(!/^[prnbqkPRNBQK]$/.test(r[n][i]))return{valid:!1,error_number:9,error:"1st field (piece positions) is invalid [invalid piece]."};s+=1,a=!1}else{if(a)return{valid:!1,error_number:8,error:"1st field (piece positions) is invalid [consecutive numbers]."};s+=parseInt(r[n][i],10),a=!0}if(8!==s)return{valid:!1,error_number:10,error:"1st field (piece positions) is invalid [row too large]."}}return"3"==e[3][1]&&"w"==e[1]||"6"==e[3][1]&&"b"==e[1]?{valid:!1,error_number:11,error:"Illegal en-passant square"}:{valid:!0,error_number:0,error:"No errors."}}function U(){for(var t=0,r="",n=u.a8;n<=u.h1;n++){if(null==e[n])t++;else{t>0&&(r+=t,t=0);var s=e[n].color,a=e[n].type;r+=s===C?a.toUpperCase():a.toLowerCase()}n+1&136&&(t>0&&(r+=t),n!==u.h1&&(r+="/"),t=0,n+=8)}var i="";T[C]&h.KSIDE_CASTLE&&(i+="K"),T[C]&h.QSIDE_CASTLE&&(i+="Q"),T[A]&h.KSIDE_CASTLE&&(i+="k"),T[A]&h.QSIDE_CASTLE&&(i+="q"),i=i||"-";var o=I===O?"-":m(I);return[r,k,i,o,S,R].join(" ")}function H(t){for(var e=0;e<t.length;e+=2)"string"==typeof t[e]&&"string"==typeof t[e+1]&&(D[t[e]]=t[e+1]);return D}function Q(t){L.length>0||(t!==n?(D.SetUp="1",D.FEN=t):(delete D.SetUp,delete D.FEN))}function j(t){var r=e[u[t]];return r?{type:r.type,color:r.color}:null}function K(t,n){if(!("type"in t)||!("color"in t))return!1;if(-1==="pnbrqkPNBRQK".indexOf(t.type.toLowerCase()))return!1;if(!(n in u))return!1;var s=u[n];return(t.type!=w||r[t.color]==O||r[t.color]==s)&&(e[s]={type:t.type,color:t.color},t.type===w&&(r[t.color]=s),Q(U()),!0)}function G(t,e,r,n,s){var a={color:k,from:e,to:r,flags:n,piece:t[e].type};return s&&(a.flags|=h.PROMOTION,a.promotion=s),t[r]?a.captured=t[r].type:n&h.EP_CAPTURE&&(a.captured=P),a}function $(t){function n(t,e,r,n,s){if(t[r].type!==P||0!==v(n)&&7!==v(n))e.push(G(t,r,n,s));else for(var a=["q","r",_,"n"],i=0,o=a.length;i<o;i++)e.push(G(t,r,n,s,a[i]))}var s=[],o=k,l=y(o),c={b:1,w:6},d=u.a8,f=u.h1,p=!1,g=void 0===t||!("legal"in t)||t.legal,m=void 0===t||!("piece"in t)||"string"!=typeof t.piece||t.piece.toLowerCase();if(void 0!==t&&"square"in t){if(!(t.square in u))return[];d=f=u[t.square],p=!0}for(var b=d;b<=f;b++)if(136&b)b+=7;else{var E=e[b];if(null!=E&&E.color===o)if(E.type!==P||!0!==m&&m!==P){if(!0===m||m===E.type)for(var A=0,C=i[E.type].length;A<C;A++){var O=i[E.type][A];for(M=b;!(136&(M+=O));){if(null!=e[M]){if(e[M].color===o)break;n(e,s,b,M,h.CAPTURE);break}if(n(e,s,b,M,h.NORMAL),"n"===E.type||"k"===E.type)break}}}else{var M=b+a[o][0];if(null==e[M]){n(e,s,b,M,h.NORMAL);M=b+a[o][1];c[o]===v(b)&&null==e[M]&&n(e,s,b,M,h.BIG_PAWN)}for(A=2;A<4;A++)136&(M=b+a[o][A])||(null!=e[M]&&e[M].color===l?n(e,s,b,M,h.CAPTURE):M===I&&n(e,s,b,I,h.EP_CAPTURE))}}if(!(!0!==m&&m!==w||p&&f!==r[o])){if(T[o]&h.KSIDE_CASTLE){var S=(R=r[o])+2;null!=e[R+1]||null!=e[S]||Y(l,r[o])||Y(l,R+1)||Y(l,S)||n(e,s,r[o],S,h.KSIDE_CASTLE)}var R;if(T[o]&h.QSIDE_CASTLE)S=(R=r[o])-2,null!=e[R-1]||null!=e[R-2]||null!=e[R-3]||Y(l,r[o])||Y(l,R-1)||Y(l,S)||n(e,s,r[o],S,h.QSIDE_CASTLE)}if(!g)return s;var L=[];for(b=0,C=s.length;b<C;b++)rt(s[b]),J(o)||L.push(s[b]),nt();return L}function W(t,e){var r="";if(t.flags&h.KSIDE_CASTLE)r="O-O";else if(t.flags&h.QSIDE_CASTLE)r="O-O-O";else{if(t.piece!==P){var n=function(t,e){for(var r=t.from,n=t.to,s=t.piece,a=0,i=0,o=0,l=0,c=e.length;l<c;l++){var h=e[l].from,u=e[l].to;s===e[l].piece&&r!==h&&n===u&&(a++,v(r)===v(h)&&i++,g(r)===g(h)&&o++)}return a>0?i>0&&o>0?m(r):o>0?m(r).charAt(1):m(r).charAt(0):""}(t,e);r+=t.piece.toUpperCase()+n}t.flags&(h.CAPTURE|h.EP_CAPTURE)&&(t.piece===P&&(r+=m(t.from)[0]),r+="x"),r+=m(t.to),t.flags&h.PROMOTION&&(r+="="+t.promotion.toUpperCase())}return rt(t),Z()&&(z()?r+="#":r+="+"),nt(),r}function Y(t,r){for(var n=u.a8;n<=u.h1;n++)if(136&n)n+=7;else if(null!=e[n]&&e[n].color===t){var s=e[n],a=n-r,i=a+119;if(o[i]&1<<c[s.type]){if(s.type===P){if(a>0){if(s.color===C)return!0}else if(s.color===A)return!0;continue}if("n"===s.type||"k"===s.type)return!0;for(var h=l[i],d=n+h,f=!1;d!==r;){if(null!=e[d]){f=!0;break}d+=h}if(!f)return!0}}return!1}function J(t){return Y(y(t),r[t])}function Z(){return J(k)}function z(){return Z()&&0===$().length}function X(){return!Z()&&0===$().length}function tt(){for(var t={},r=[],n=0,s=0,a=u.a8;a<=u.h1;a++)if(s=(s+1)%2,136&a)a+=7;else{var i=e[a];i&&(t[i.type]=i.type in t?t[i.type]+1:1,i.type===_&&r.push(s),n++)}if(2===n)return!0;if(3===n&&(1===t[_]||1===t.n))return!0;if(n===t[_]+2){var o=0,l=r.length;for(a=0;a<l;a++)o+=r[a];if(0===o||o===l)return!0}return!1}function et(){for(var t=[],e={},r=!1;;){var n=nt();if(!n)break;t.push(n)}for(;;){var s=U().split(" ").slice(0,4).join(" ");if(e[s]=s in e?e[s]+1:1,e[s]>=3&&(r=!0),!t.length)break;rt(t.pop())}return r}function rt(t){var n=k,s=y(n);if(function(t){L.push({move:t,kings:{b:r.b,w:r.w},turn:k,castling:{b:T.b,w:T.w},ep_square:I,half_moves:S,move_number:R})}(t),e[t.to]=e[t.from],e[t.from]=null,t.flags&h.EP_CAPTURE&&(k===A?e[t.to-16]=null:e[t.to+16]=null),t.flags&h.PROMOTION&&(e[t.to]={type:t.promotion,color:n}),e[t.to].type===w){if(r[e[t.to].color]=t.to,t.flags&h.KSIDE_CASTLE){var a=t.to-1,i=t.to+1;e[a]=e[i],e[i]=null}else t.flags&h.QSIDE_CASTLE&&(a=t.to+1,i=t.to-2,e[a]=e[i],e[i]=null);T[n]=""}if(T[n])for(var o=0,l=d[n].length;o<l;o++)if(t.from===d[n][o].square&&T[n]&d[n][o].flag){T[n]^=d[n][o].flag;break}if(T[s])for(o=0,l=d[s].length;o<l;o++)if(t.to===d[s][o].square&&T[s]&d[s][o].flag){T[s]^=d[s][o].flag;break}I=t.flags&h.BIG_PAWN?"b"===k?t.to-16:t.to+16:O,t.piece===P||t.flags&(h.CAPTURE|h.EP_CAPTURE)?S=0:S++,k===A&&R++,k=y(k)}function nt(){var t=L.pop();if(null==t)return null;var n=t.move;r=t.kings,k=t.turn,T=t.castling,I=t.ep_square,S=t.half_moves,R=t.move_number;var s,a,i=k,o=y(k);if(e[n.from]=e[n.to],e[n.from].type=n.piece,e[n.to]=null,n.flags&h.CAPTURE)e[n.to]={type:n.captured,color:o};else if(n.flags&h.EP_CAPTURE){var l;l=i===A?n.to-16:n.to+16,e[l]={type:P,color:o}}return n.flags&(h.KSIDE_CASTLE|h.QSIDE_CASTLE)&&(n.flags&h.KSIDE_CASTLE?(s=n.to+1,a=n.to-1):n.flags&h.QSIDE_CASTLE&&(s=n.to-2,a=n.to+1),e[s]=e[a],e[a]=null),n}function st(t,e){for(var r=p(t),n=0;n<2;n++){if(1==n){if(!e)return null;var s=!1;if(c=r.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/)){var a=c[1],i=c[2],o=c[3],l=c[4];1==i.length&&(s=!0)}else{var c;(c=r.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/))&&(a=c[1],i=c[2],o=c[3],l=c[4],1==i.length&&(s=!0))}}for(var h=f(r),d=$({legal:!0,piece:a||h}),v=0,g=d.length;v<g;v++)switch(n){case 0:if(r===p(W(d[v],d)))return d[v];break;case 1:if(c){if(!(a&&a.toLowerCase()!=d[v].piece||u[i]!=d[v].from||u[o]!=d[v].to||l&&l.toLowerCase()!=d[v].promotion))return d[v];if(s){var y=m(d[v].from);if(!(a&&a.toLowerCase()!=d[v].piece||u[o]!=d[v].to||i!=y[0]&&i!=y[1]||l&&l.toLowerCase()!=d[v].promotion))return d[v]}}}}return null}function at(t){var e=b(t);e.san=W(e,$({legal:!0})),e.to=m(e.to),e.from=m(e.from);var r="";for(var n in h)h[n]&e.flags&&(r+=M[n]);return e.flags=r,e}function it(t){for(var e=$({legal:!1}),r=0,n=k,s=0,a=e.length;s<a;s++)rt(e[s]),J(n)||(t-1>0?r+=it(t-1):r++),nt();return r}return q(void 0===t?n:t),{load:function(t){return q(t)},reset:function(){return x()},swapTurn:function(){this.turn==C?this.turn=A:this.turn=C},moves:function(t){for(var e=$(t),r=[],n=0,s=e.length;n<s;n++)void 0!==t&&"verbose"in t&&t.verbose?r.push(at(e[n])):r.push(W(e[n],$({legal:!0})));return r},in_check:function(){return Z()},in_checkmate:function(){return z()},in_stalemate:function(){return X()},in_draw:function(){return S>=100||X()||tt()||et()},insufficient_material:function(){return tt()},in_threefold_repetition:function(){return et()},game_over:function(){return S>=100||z()||X()||tt()||et()},validate_fen:function(t){return V(t)},fen:function(){return U()},board:function(){for(var t=[],r=[],n=u.a8;n<=u.h1;n++)null==e[n]?r.push(null):r.push({square:m(n),type:e[n].type,color:e[n].color}),n+1&136&&(t.push(r),r=[],n+=8);return t},pgn:function(t){var e="object"==typeof t&&"string"==typeof t.newline_char?t.newline_char:"\n",r="object"==typeof t&&"number"==typeof t.max_width?t.max_width:0,n=[],s=!1;for(var a in D)n.push("["+a+' "'+D[a]+'"]'+e),s=!0;s&&L.length&&n.push(e);for(var i=function(t){var e=B[U()];return void 0!==e&&(t=`${t}${t.length>0?" ":""}{${e}}`),t},o=[];L.length>0;)o.push(nt());var l=[],c="";for(0===o.length&&l.push(i(""));o.length>0;){c=i(c);var h=o.pop();if(L.length||"b"!==h.color)"w"===h.color&&(c.length&&l.push(c),c=R+".");else{const t=`${R}. ...`;c=c?`${c} ${t}`:t}c=c+" "+W(h,$({legal:!0})),rt(h)}if(c.length&&l.push(i(c)),void 0!==D.Result&&l.push(D.Result),0===r)return n.join("")+l.join(" ");var u=function(){return n.length>0&&" "===n[n.length-1]&&(n.pop(),!0)},d=function(t,s){for(var a of s.split(" "))if(a){if(t+a.length>r){for(;u();)t--;n.push(e),t=0}n.push(a),t+=a.length,n.push(" "),t++}return u()&&t--,t},f=0;for(a=0;a<l.length;a++)f+l[a].length>r&&l[a].includes("{")?f=d(f,l[a]):(f+l[a].length>r&&0!==a?(" "===n[n.length-1]&&n.pop(),n.push(e),f=0):0!==a&&(n.push(" "),f++),n.push(l[a]),f+=l[a].length);return n.join("")},load_pgn:function(t,e){var r=void 0!==e&&"sloppy"in e&&e.sloppy;function n(t){return t.replace(/\\/g,"\\")}t=t.trim();var a="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\r?\n",i=new RegExp("^(\\[((?:"+n(a)+")|.)*\\])(?:\\s*"+n(a)+"){2}"),o=i.test(t)?i.exec(t)[1]:"";x();var l=function(t,e){for(var r="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\r?\n",s={},a=t.split(new RegExp(n(r))),i="",o="",l=0;l<a.length;l++){var c=/^\s*\[([A-Za-z]+)\s*"(.*)"\s*\]\s*$/;i=a[l].replace(c,"$1"),o=a[l].replace(c,"$2"),E(i).length>0&&(s[i]=o)}return s}(o,e),c="";for(var h in l)"fen"===h.toLowerCase()&&(c=l[h]),H([h,l[h]]);if(r){if(c&&!q(c,!0))return!1}else if(!("1"!==l.SetUp||"FEN"in l&&q(l.FEN,!0)))return!1;for(var u=function(t){return`{${function(t){return Array.from(t).map((function(t){return t.charCodeAt(0)<128?t.charCodeAt(0).toString(16):encodeURIComponent(t).replace(/\%/g,"").toLowerCase()})).join("")}((t=t.replace(new RegExp(n(a),"g")," ")).slice(1,t.length-1))}}`},d=function(t){if(t.startsWith("{")&&t.endsWith("}"))return function(t){return 0==t.length?"":decodeURIComponent("%"+t.match(/.{1,2}/g).join("%"))}(t.slice(1,t.length-1))},f=t.replace(o,"").replace(new RegExp(`({[^}]*})+?|;([^${n(a)}]*)`,"g"),(function(t,e,r){return void 0!==e?u(e):" "+u(`{${r.slice(1)}}`)})).replace(new RegExp(n(a),"g")," "),p=/(\([^\(\)]+\))+?/g;p.test(f);)f=f.replace(p,"");var v=E(f=(f=(f=f.replace(/\d+\.(\.\.)?/g,"")).replace(/\.\.\./g,"")).replace(/\$\d+/g,"")).split(new RegExp(/\s+/));v=v.join(",").replace(/,,+/g,",").split(",");for(var g="",m="",y=0;y<v.length;y++){var b=d(v[y]);if(void 0===b)if(null==(g=st(v[y],r))){if(!(s.indexOf(v[y])>-1))return!1;m=v[y]}else m="",rt(g);else B[U()]=b}return m&&Object.keys(D).length&&!D.Result&&H(["Result",m]),!0},header:function(){return H(arguments)},turn:function(){return k},move:function(t,e){var r=void 0!==e&&"sloppy"in e&&e.sloppy,n=null;if("string"==typeof t)n=st(t,r);else if("object"==typeof t)for(var s=$(),a=0,i=s.length;a<i;a++)if(t.from===m(s[a].from)&&t.to===m(s[a].to)&&(!("promotion"in s[a])||t.promotion===s[a].promotion)){n=s[a];break}if(!n)return null;var o=at(n);return rt(n),o},undo:function(){var t=nt();return t?at(t):null},clear:function(){return N()},put:function(t,e){return K(t,e)},get:function(t){return j(t)},ascii(){for(var t="   +------------------------+\n",r=u.a8;r<=u.h1;r++){if(0===g(r)&&(t+=" "+"87654321"[v(r)]+" |"),null==e[r])t+=" . ";else{var n=e[r].type;t+=" "+(e[r].color===C?n.toUpperCase():n.toLowerCase())+" "}r+1&136&&(t+="|\n",r+=8)}return(t+="   +------------------------+\n")+"     a  b  c  d  e  f  g  h"},remove:function(t){return function(t){var n=j(t);return e[u[t]]=null,n&&n.type===w&&(r[n.color]=O),Q(U()),n}(t)},perft:function(t){return it(t)},square_color:function(t){if(t in u){var e=u[t];return(v(e)+g(e))%2==0?"light":"dark"}return null},history:function(t){for(var e=[],r=[],n=(void 0!==t&&"verbose"in t&&t.verbose);L.length>0;)e.push(nt());for(;e.length>0;){var s=e.pop();n?r.push(at(s)):r.push(W(s,$({legal:!0}))),rt(s)}return r},get_comment:function(){return B[U()]},set_comment:function(t){B[U()]=t.replace("{","[").replace("}","]")},delete_comment:function(){var t=B[U()];return delete B[U()],t},get_comments:function(){return F(),Object.keys(B).map((function(t){return{fen:t,comment:B[t]}}))},delete_comments:function(){return F(),Object.keys(B).map((function(t){var e=B[t];return delete B[t],{fen:t,comment:e}}))}}}},344:(t,e,r)=>{r.d(e,{b:()=>a}),r(618);var n=r(842),s=r(689);class a{constructor(t){this.stockfishOrchestrator=null,this.gameAnalysis=[],this.guiHandler=t,this.analysisArray=[],this.stopped=!1,this.running=!1}clearData(){this.gameAnalysis=[],this.analysisArray=[]}calculateMoveBrilliance(t,e){if(0==e)return"gray";const r=e%2,n=this.analysisArray[this.analysisArray.length-2],a=this.analysisArray[this.analysisArray.length-1];if(!(1 in n))return"gray";const i=(a[0].CP-n[0].CP)*(r?1:-1);if(this.analysisArray.length>2){const e=this.analysisArray[this.analysisArray.length-3];if(i>-75&&(1==r&&a[0].CP>0||0==r&&a[0].CP<0)&&s.HX(e[0].FEN,n[0].FEN,a[0].FEN,t))return"brilliant"}return t==n[0].move?Math.abs(Math.abs(n[0].CP)-Math.abs(n[1].CP))>100?"great":"best":t==n[1].move&&Math.abs(Math.abs(n[0].CP)-Math.abs(n[1].CP))<100?"good":i<-200?"mistake":"gray"}sendEval(t){if(this.stopped)return;var e=t.positionEvaluation,r=(t.FENstring,t.regularMove),n=t.moveIndex;this.analysisArray.push(e);const s={},a=e[0].CP;if("mate"==e[0].cpOrMate)if(1==e[0].isCheckmated)s.CP="M0",s.evaluation=49*-a;else{console.log(a),console.log(e);const t=a>0?1:-1;s.CP="M"+a.toString(),s.evaluation=49*t}else{var i=50*(2/(1+Math.exp(-.004*a))-1);s.evaluation=i,s.CP=a}s.moveRating=this.calculateMoveBrilliance(r,n),this.gameAnalysis.push(s),console.log("gameAnalysis",JSON.stringify(this.gameAnalysis),"analsisArray",JSON.stringify(this.analysisArray),"moveArray",JSON.stringify(this.moveArray),"fenarray",JSON.stringify(this.fenArray)),this.guiHandler.updateGraph(this.gameAnalysis)}async stopAnalysis(){if(0!=this.running){for(this.stopped=!0;this.stopped;)console.log("Cekam"),await new Promise((t=>setTimeout(t,100)));this.clearData(),console.log("stopped and started new")}}async analyzePgnGame(t,e,r,s=[],a=[]){var i;await this.stopAnalysis(),s&&(this.gameAnalysis=s),a&&(this.analysisArray=a),console.log("he alredy analyzed",s,a),console.log("KURAC"),console.log("fenMoves",t),console.log("moveArray",e),this.stockfishOrchestrator&&this.stockfishOrchestrator.deleteWorker(),this.stockfishOrchestrator=await(0,n.e)(!1),this.stockfishOrchestrator.analysisOrchestrator=this,this.stockfishOrchestrator.setCallback((t=>{this.sendEval(t)})),console.log("Propusten dalje"),this.running=!0,this.moveArray=e,this.fromPerspective=r,this.fenArray=t,i=this.gameAnalysis?this.gameAnalysis.length:0,this.guiHandler.updateGraph(this.gameAnalysis);for(let r=i;r<t.length;r++){const n=t[r];if(this.stopped){console.log("nasilno stopiram");break}0==r?await this.stockfishOrchestrator.waitForRun(n,"",r):await this.stockfishOrchestrator.waitForRun(n,e[r-1].fromto,r)}console.log("gotov"),this.stopped=!1,this.running=!1}}},241:(t,e,r)=>{r.a(t,(async(t,n)=>{try{r.d(e,{Z:()=>o});var s=r(392),a=r(735),i=t([s]);s=(i.then?(await i)():i)[0];class o{constructor(){this.activeTiles=[],this.chessBoard=Chessboard2("chessground",s.W3)}clearArrows(){this.chessBoard.clearArrows()}addBestMoveArrow(t){this.chessBoard.clearArrows();const e=t.substring(0,2),r=t.substring(2,4);this.addArrowToBoard(e,r)}addArrowToBoard(t,e){const r=t+"-"+e;console.log(`NACRTAJ MI STRELICU OD ${r} DA TI NE BIH JEBAO MAMU`),this.chessBoard.addArrow(r,"small")}getChessboard(){return this.chessBoard}flipBoard(){this.chessBoard.flip(),this.flipPromotionPopup(document.getElementById("promotion_bar"))}createButton(t,e,r,n,s){const i=document.createElement("div");i.classList.add("promotion-figure-button");const o=document.createElement("img");return o.src="/img/chesspieces/wikipedia/"+s+a.D.PROMOTION_TO_CHAR[t].toUpperCase()+".png",o.id=`button-${t}`,o.addEventListener("click",(s=>this.promotionChosenCallback(s,e,r,n,t))),i.appendChild(o),i}promotionChosenCallback(t,e,r,n,s){const i=document.getElementById("promotion_bar");for(i.style.visibility="hidden";i.firstChild;)i.removeChild(i.firstChild);e(r,n,a.D.PROMOTION_TO_CHAR[s])}movePromotionPopup(t,e,r){console.log(e);const n=100*(0,s.dF)(e),a="w"==r?0:100;console.log("translate",n,a),"white"==this.chessBoard.orientation()?t.style.transform=`translate(${n}%, ${a}%)`:t.style.transform=`translate(${700-n}%, ${100-a}%)`}flipPromotionPopup(t){const e=t.style.transform,r=/translate\((\d+)%, (\d+)%\)/.exec(e);if(r){const e=parseInt(r[1]),n=parseInt(r[2]);t.style.transform=`translate(${700-e}%, ${100-n}%)`}}createPromotionPopup(t,e,r,n){console.log("PRAVIM DUGMICE");const s=document.getElementById("promotion_bar");this.movePromotionPopup(s,r,n),s.style.visibility="visible";for(let a=0;a<=3;a++){const i=this.createButton(a,t,e,r,n);s.appendChild(i)}}colorTile(t,e,r="yellow_tile"){var n=document.getElementById("chessground");const s=8-parseInt(t[1]),i=t[0].charCodeAt(0)-"a".charCodeAt(0);if(s>=0&&s<8&&i>=0&&i<8){var o=n.firstElementChild.firstElementChild.children[1].children[s].children[i];if(e==a.D.TILE_COLORS.ACTIVE){const e=o.classList[o.classList.length-1];"active"!=e&&(this.activeTiles.push(t),"inactive"==e?(o.classList.remove(e),o.classList.add(r)):o.classList.add(r))}else e==a.D.TILE_COLORS.INACTIVE&&(o.classList.remove(o.classList[o.classList.length-1]),o.classList.add("kurac"))}}deactivateTiles(){for(;this.activeTiles.length>0;)this.colorTile(this.activeTiles[this.activeTiles.length-1],a.D.TILE_COLORS.INACTIVE),this.activeTiles.pop()}}n()}catch(t){n(t)}}))},759:(t,e,r)=>{r.d(e,{Q:()=>c});var n=0;const s={id:"verticalLinePlugin",afterEvent:function(t,e){if("click"==e.event.type){const{ctx:e,tooltip:r,chartArea:{top:s,right:a,bottom:i,left:o,width:l,height:c},scales:{x:h,y:u}}=t;n=r.dataPoints[0].dataIndex,console.log(n)}},afterDatasetsDraw(t,e,r){const{ctx:s,tooltip:a,chartArea:{top:i,right:o,bottom:l,left:c,width:h,height:u},scales:{x:d,y:f}}=t,p=d.getPixelForValue(n);s.restore(),s.strokeStyle="rgba(170, 252, 255, 0.8)",s.strokeRect(p,i,0,u),s.save()}},a={id:"hoverLinePlugin",beforeDatasetsDraw(t,e,r){const{ctx:n,tooltip:s,chartArea:{top:a,right:i,bottom:o,left:l,width:c,height:h},scales:{x:u,y:d}}=t;if(s._active.length>0){const t=u.getPixelForValue(s.dataPoints[0].dataIndex);n.save(),n.strokeStyle="gray",n.strokeRect(t,a,0,h)}}};var i=r(735),o={lineAtIndex:[2,4,8],labels:[],datasets:[{label:"Data",data:[],lineTension:0,fill:{above:"rgba(255, 255, 255, 0.8)",below:"rgba(0, 0, 0, 0.8)",target:{value:0}},borderWidth:0,pointHitRadius:50,usePointStyle:!0,pointStyle:"circle",pointRadius:[],hoverRadius:5,hoverBorderWidth:0,borderColor:"rgba(170, 252, 255, 0.8)"}]},l=[];class c{constructor(t){this.chartData=o,this.canvasId=t,this.gameAnalysis=null;const e=document.getElementById(t);this.graph=new Chart(e,{type:"line",data:this.chartData,plugins:[s,a],options:{pointBackgroundColor:t=>{const e=t.dataIndex;try{return i.D.Colors[this.gameAnalysis[e].moveRating]}catch(t){return"gray"}},plugins:{legend:{display:!1},verticalLinePlugin:{lineColor:"cyan",xPosition:3},tooltip:{bodySpacing:0,displayColors:!1,callbacks:{title:function(t,e){return""},body:function(t){return"k"},label:function(t){return l[t.dataIndex].CP.toString()}}}},responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},scales:{y:{min:-50,max:50,ticks:{display:!1}},x:{ticks:{display:!1}}},onClick:t=>{const e=Chart.helpers.getRelativePosition(t,this.graph),r=this.graph.scales.x.getValueForPixel(e.x),n=this.graph.scales.y.getValueForPixel(e.y);console.log(r,n),this.playerControllerInst.gotoMove(r)}}})}clearData(){this.gameAnalysis=[],l=[],this.chartData.labels=[],this.chartData.datasets[0].data=[],this.chartData.datasets[0].pointRadius=[],this.graph.update()}updateGraph(t){this.gameAnalysis=t,l=t;var e=this.chartData.labels=[],r=this.chartData.datasets[0].data=[],n=this.chartData.datasets[0].pointRadius=[];for(const t of this.gameAnalysis)e.push(t.CP.toString()),r.push(t.evaluation),n.push(i.D.pointSizes[t.moveRating]);this.graph.update()}updateGraphSelectedMove(t){!function(t){n=t}(t),this.graph.update()}}},307:(t,e,r)=>{r.a(t,(async(t,n)=>{try{r.d(e,{C:()=>l});var s=r(989),a=r(735),i=r(241),o=t([i]);i=(o.then?(await o)():o)[0];class l{constructor(t,e){this.soundHandler=new s.F,this.evaluationGraph=t,this.chessboardHandler=new i.Z,this.sidebar=e,this.boardOrientation="white"}setBoardOrientation(t){this.boardOrientation!=t&&this.flipBoard()}clearData(){this.gameAnalysis=[],this.evaluationGraph.clearData()}showImportPopup(){console.log("Vsiible"),document.getElementById("import_popup").style.visibility="visible"}hideImportPopup(){document.getElementById("import_popup").style.visibility="hidden"}clearArrows(){this.chessboardHandler.clearArrows()}addBestMoveArrow(t){this.chessboardHandler.addBestMoveArrow(t)}addArrowToBoard(t,e){this.chessboardHandler.addArrowToBoard(t,e)}getChessboard(){return this.chessboardHandler.getChessboard()}flipBoard(){"white"==this.boardOrientation?this.boardOrientation="black":this.boardOrientation="white",this.chessboardHandler.flipBoard()}createPromotionPopup(t,e,r,n){this.chessboardHandler.createPromotionPopup(t,e,r,n)}colorTile(t,e,r="yellow_tile"){this.chessboardHandler.colorTile(t,e,r)}deactivateTiles(){this.chessboardHandler.deactivateTiles()}colorTilesForMove(t,e,r){if(this.deactivateTiles(),""!=t&&""!=e){const n=this.gameAnalysis[r].moveRating,s=a.D.CssDictForTiles[n];this.colorTile(t,a.D.TILE_COLORS.ACTIVE,s),this.colorTile(e,a.D.TILE_COLORS.ACTIVE,s)}}async setBoardAndMove(t,e,r,n,s=a.D.MOVE_TYPE.MOVE_NONE){this.soundHandler.playSound(s),this.evaluationGraph.updateGraphSelectedMove(n),this.chessboardHandler.getChessboard().position(t,!1),this.colorTilesForMove(e,r,n)}updateGraph(t){this.gameAnalysis=t,this.evaluationGraph.updateGraph(t)}updateSidebar(t){this.sidebar.setAnalysisData(t)}}n()}catch(t){n(t)}}))},587:(t,e,r)=>{r.a(t,(async(t,n)=>{try{r.d(e,{n:()=>i});var s=r(392),a=t([s]);s=(a.then?(await a)():a)[0];class i{constructor(t,e,r){this.stockfishOrchestrator=t,this.guiHandler=e,this.stockfishOrchestrator.setCallback((t=>{this.evaluationGetCallback(t)})),this.div=r,this.enabled=!1,this.lastFen="",document.getElementById("toggleSwitch").addEventListener("change",this.toggleSwitched.bind(this))}disableAllLines(){var t=this.div.children;for(let e=0;e<t.length;e++)t[e].style.display="none"}toggleSwitched(){this.enabled=!this.enabled,this.enabled?(console.log("LBE enabled"),this.evaulateNewBoard(this.lastFen)):(this.disableAllLines(),this.guiHandler.clearArrows())}evaluationGetCallback(t){var e=t.positionEvaluation;if(this.enabled){var r=this.div.children;let t=0;console.log(e);const a=e[0].move;for(this.guiHandler.addBestMoveArrow(a);t in e;){var n=r[t];if("none"===window.getComputedStyle(n).display&&(n.style.display="flex"),console.log(e[t]),n.querySelector(".liveBestMove").textContent=(0,s.wV)(e[t].move,e[t].FEN),"cp"==e[t].cpOrMate){const r=parseFloat(e[t].CP)/100>0;n.querySelector(".liveEvaluation").textContent=(r?"+":"")+(parseFloat(e[t].CP)/100).toString()}else n.querySelector(".liveEvaluation").textContent="M"+e[t].CP;t++}}}evaulateNewBoard(t){this.lastFen=t,this.enabled&&""!=t&&this.stockfishOrchestrator.stopAndStartNewAnalysis(t)}}n()}catch(t){n(t)}}))},180:(t,e,r)=>{r.a(t,(async(t,n)=>{try{r.d(e,{Z:()=>c});var s=r(689),a=r(618),i=r(735),o=r(392),l=t([o]);o=(l.then?(await l)():l)[0];class c{constructor(t,e,r){this.liveBoardEvaluation=r,this.currentPgn=null,this.analysisOrchestrator=e,this.guiHandler=t,this.currentMove=0,this.mainChessObject=(0,a.qQ)(),this.alternativeChessObject=(0,a.qQ)(),this.alternativeStackLeft=[],this.alternativeStackRight=[],this.inAlternativePath=!1,this.liveBoardEvaluation=r,this.ready=!1}getMoveType(t){return"c"==t?i.D.MOVE_TYPE.MOVE_CAPTURE:i.D.MOVE_TYPE.MOVE_REGULAR}moveArrayToPgn(t){var e=(0,a.qQ)();for(const r of t)console.log(r.san),e.move(r.san);return console.log(e.pgn()),e.pgn()}setGameFromExtension(t,e,r,n,s,a=!1){if(console.log("injector tried to call me",this.ready,t,e),a||this.ready){this.currentFenArray=t,this.currentMoveArray=e,this.analysisData=r;const a=this.moveArrayToPgn(e);return this.guiHandler.setBoardOrientation(s),this.guiHandler.updateSidebar(a),this.startAnalysis(n),!0}return!1}setPgn(t){this.analysisData=[],this.currentPgn=t,this.currentFenArray=(0,s.FB)(this.currentPgn),this.currentMoveArray=(0,s.QZ)(this.currentPgn),this.guiHandler.updateSidebar(t),this.gotoMove(0),this.guiHandler.clearData(),this.startAnalysis()}getChessObject(){return this.inAlternativePath?this.alternativeChessObject:this.mainChessObject}getAlternativeChessObject(){return this.alternativeChessObject}getInAlternative(){return this.inAlternativePath}startAnalysis(t=[]){this.analysisOrchestrator.analyzePgnGame(this.currentFenArray,this.currentMoveArray,"white",this.analysisData,t)}updateBoardGUI(t,e,r,n,s){this.guiHandler.setBoardAndMove(t,e,r,n,s),this.liveBoardEvaluation.evaulateNewBoard(t)}makeAlternativeMove(t,e){const r=t.substring(0,2),n=t.substring(2,4),s=this.alternativeChessObject.move({from:r,to:n,promotion:e});if(console.log(s,t,this.alternativeChessObject.fen()),!s)return"snapback";{const s=this.alternativeChessObject.fen();this.inAlternativePath=!0,this.updateBoardGUI(s,r,n,this.currentMove,i.D.MOVE_TYPE.MOVE_REGULAR),this.alternativeStackLeft.push([t,e])}}makePossibleAlternativeMove(t,e){var r;return this.guiHandler.getChessboard().clearCircles(),this.currentMove>=this.currentMoveArray.length?this.inAlternativePath=!0:r=this.currentMoveArray[this.currentMove].from+this.currentMoveArray[this.currentMove].to,1==this.inAlternativePath||t!=r?this.makeAlternativeMove(t,e):void this.gotoMove(this.currentMove+1)}goBackwards(){if(this.inAlternativePath){const t=this.alternativeStackLeft.pop();this.alternativeStackRight.push(t);const e=t[0].substring(0,2),r=t[0].substring(2,4);this.alternativeChessObject.undo(),this.guiHandler.setBoardAndMove(this.alternativeChessObject.fen(),e,r,this.currentMove,i.D.MOVE_TYPE.MOVE_REGULAR),this.alternativeChessObject.fen()==this.mainChessObject.fen()&&(this.inAlternativePath=!1)}else this.gotoMove(this.currentMove-1)}goForwards(){if(this.inAlternativePath){if(this.alternativeStackRight.length>0){const t=this.alternativeStackRight.pop();this.makePossibleAlternativeMove(t[0],t[1])}}else this.gotoMove(this.currentMove+1)}gotoMove(t){if(this.inAlternativePath=!1,t=(0,o.mY)(t,0,this.currentMoveArray.length),this.currentMove=t,this.mainChessObject.load(this.currentFenArray[t]),this.alternativeChessObject.load(this.currentFenArray[t]),t>0){console.log(this.currentFenArray[t]);const e=this.currentMoveArray[t-1].flags,r=this.getMoveType(e);this.updateBoardGUI(this.currentFenArray[t],this.currentMoveArray[t-1].fromto.substring(0,2),this.currentMoveArray[t-1].fromto.substring(2,4),t,r)}else this.updateBoardGUI(this.currentFenArray[t],"","",t,i.D.MOVE_TYPE.MOVE_REGULAR)}}n()}catch(t){n(t)}}))},337:(t,e,r)=>{r.d(e,{Y:()=>s});var n=r(618);class s{constructor(t){this.div=t,document.getElementById("flipBoardButton").addEventListener("click",(()=>{this.guiHandler.flipBoard()})),document.getElementById("loadpgnButton").addEventListener("click",(()=>{this.guiHandler.showImportPopup()})),document.getElementById("import-button").addEventListener("click",(()=>{this.importFromText()})),document.getElementById("close-import-button").addEventListener("click",(()=>{this.guiHandler.hideImportPopup()}))}importFromText(){const t=document.getElementById("pgn_textarea").value;this.guiHandler.hideImportPopup(),this.playerController.setPgn(t)}setAnalysisData(t){console.log("SETUP");const e=t=>{this.playerController.gotoMove(parseInt(t.target.id)+1)},r=(t,r,n)=>{const s=document.createElement("div");s.id=`${t+1}`,s.textContent=""+(t+1)/2,s.className="move-element";const a=document.createElement("div");if(a.className="move-notation clickable",a.textContent=r,a.id=""+(t-1),a.addEventListener("click",e),s.appendChild(a),""!=n){const r=document.createElement("div");r.className="move-notation clickable",r.textContent=n,r.id=`${t}`,r.addEventListener("click",e),s.appendChild(r)}return s};for(;this.div.firstChild;)this.div.removeChild(this.div.firstChild);const s=function(t){const e=(0,n.qQ)();e.load_pgn(t);const r=e.history();var s=[];return r.forEach(((t,e)=>{s.push(t)})),s}(t);var a=[];if(s.forEach(((t,e)=>{if(a.push(t),2==a.length){const t=r(e,a[0],a[1]);this.div.appendChild(t),a=[]}})),1==a.length){const t=r(s.length,a[0],"");this.div.appendChild(t)}}}},989:(t,e,r)=>{r.d(e,{F:()=>a});var n=r(735);async function s(t){const e=await fetch(t);return await e.blob()}class a{constructor(){this.audioArray=Array(4).fill(void 0),s("/assets/audio/standard/Move.mp3").then((t=>{this.audioArray[n.D.MOVE_TYPE.MOVE_REGULAR]=URL.createObjectURL(t)})),s("/assets/audio/standard/Capture.mp3").then((t=>{this.audioArray[n.D.MOVE_TYPE.MOVE_CAPTURE]=URL.createObjectURL(t)})),s("/assets/audio/standard/Check.mp3").then((t=>{this.audioArray[n.D.MOVE_TYPE.MOVE_CHECK]=URL.createObjectURL(t)})),s("/assets/audio/standard/Victory.mp3").then((t=>{this.audioArray[n.D.MOVE_TYPE.MOVE_MATE]=URL.createObjectURL(t)}))}enableSound(){this.enabled=!0}disableSound(){this.enabled=!1}playSound(t){if(t!=n.D.MOVE_TYPE.MOVE_NONE){let e=new Audio(this.audioArray[t]);e.volume=.5,e.play()}}}},735:(t,e,r)=>{var n;r.d(e,{D:()=>n}),function(t){let e,r,n,s;t.STOCKFISH_MOVETIME=1500,function(t){t[t.MOVE_REGULAR=0]="MOVE_REGULAR",t[t.MOVE_CAPTURE=1]="MOVE_CAPTURE",t[t.MOVE_CHECK=2]="MOVE_CHECK",t[t.MOVE_MATE=3]="MOVE_MATE",t[t.MOVE_NONE=4]="MOVE_NONE"}(e=t.MOVE_TYPE||(t.MOVE_TYPE={})),function(t){t[t.ACTIVE=0]="ACTIVE",t[t.INACTIVE=1]="INACTIVE"}(r=t.TILE_COLORS||(t.TILE_COLORS={})),function(t){t[t.WHITE=0]="WHITE",t[t.BLACK=1]="BLACK",t[t.BOTH=2]="BOTH"}(n=t.ANALYSIS_FOR||(t.ANALYSIS_FOR={})),t.Colors={brilliant:"rgba(15, 255, 243, 1)",great:"rgba(107, 111, 229, 1)",best:"gray",good:"gray",gray:"gray",mistake:"red"},t.CssDictForTiles={brilliant:"brilliant_tile",great:"great_tile",best:"yellow_tile",good:"yellow_tile",gray:"yellow_tile",mistake:"mistake_tile"},t.pointSizes={brilliant:3,great:3,best:1,good:1,gray:1,mistake:1},function(t){t[t.QUEEN=0]="QUEEN",t[t.ROOK=1]="ROOK",t[t.BISHOP=2]="BISHOP",t[t.KNIGHT=3]="KNIGHT"}(s=t.PROMOTION||(t.PROMOTION={})),t.PROMOTION_TO_CHAR={0:"q",1:"r",2:"n",3:"b"},t.PROMOTION_CHAR_TO_IMAGE_URL={q:"/img/chesspieces/wikipedia/bQ.png",r:"/img/chesspieces/wikipedia/bR.png",n:"/img/chesspieces/wikipedia/bN.png",b:"/img/chesspieces/wikipedia/bB.png"}}(n||(n={}))},824:(t,e,r)=>{r.a(t,(async(t,n)=>{try{r.d(e,{sV:()=>v,tQ:()=>y});var s=r(344),a=r(759),i=r(307),o=r(180),l=r(337),c=r(842),h=r(587),u=t([i,o,h]);[i,o,h]=u.then?(await u)():u;const f=new l.Y(document.getElementById("sidebarComponent")),p=new a.Q("myChart"),v=new i.C(p,f);var d=new s.b(v);const g=await(0,c.e)(!0),m=new h.n(g,v,document.getElementById("liveEvaluationContainer")),y=new o.Z(v,d,m);f.playerController=y,f.guiHandler=v,console.log("playerControllerSet"),document.addEventListener("keydown",(function(t){37===t.keyCode?y.goBackwards():39===t.keyCode&&y.goForwards()})),p.playerControllerInst=y,window.playerControllerInst=y,console.log("KURAC"),console.log(y.ready),y.ready=!0,n()}catch(t){n(t)}}),1)},689:(t,e,r)=>{r.d(e,{FB:()=>s,HX:()=>v,QZ:()=>a});var n=r(618);function s(t){const e=(0,n.qQ)();e.load_pgn(t);const r=e.history();var s=[];const a=(0,n.qQ)();return s.push(a.fen()),r.forEach(((t,e)=>{a.move(t),s.push(a.fen())})),s}function a(t){const e=(0,n.qQ)();e.load_pgn(t);const r=e.history({verbose:!0});return r.forEach(((t,e)=>{t.fromto=t.from+t.to})),r}const i={q:9,r:5,b:3,n:3,p:1,k:0};function o(t){return String.fromCharCode(97+t%8)+(8-Math.floor(t/8))}function l(t,e,r){if(r!=t.turn()){const e=h(t.fen());t=(0,n.qQ)(e)}let s=0;const a=t.get(e);if(null==a)return 0;if(a.color==r)return 0;const[i,o]=function(t,e,r){const n=t.get(e);if(n&&n.color===r)return[-1,-1];const s=function(t,e,r){const n=t.moves({verbose:!0});var s=[];for(const t of n)t.to==r&&s.push(t.from);return s}(t,0,e);let a=null,i=-1;for(const e of s){const r=t.get(e).type;(null===a||c(r)<c(a))&&(a=r,i=e)}return[a,i]}(t,e,r),u=a.type;return i&&u&&(function(t,e){t.move({from:e.substring(0,2),to:e.substring(2,4)})}(t,`${o}${e}`),s=Math.max(0,c(u)-l(t,e,function(t){return"w"===t?"b":"w"}(r))),function(t){t.undo()}(t)),s}function c(t){const e=t.toLowerCase();return i[e]}function h(t){var e=t.split(" ");return"w"==e[1]?e[1]="b":e[1]="w",e.join(" ")}function u(t){return t.split(" ")[1]}function d(t,e){let r=0;u(t)!=e&&(t=h(t));for(let n=0;n<64;n++)r=Math.max(r,f(t,o(n),e));return r}function f(t,e,r){return l((0,n.qQ)(t),e,r)}function p(t,e){const r=(0,n.qQ)();r.load(t);let s=0;for(let t=0;t<64;t++){const n=o(t),a=r.get(n);null!==a&&a.color===e&&(s+=c(a.type))}return s}function v(t,e,r,s){if(function(t){const e=(0,n.qQ)(t);return!(!e.in_check()||1!=e.moves.length)}(e))return!1;const a=u(t),i=p(t,a)-p(r,a),o=d(r,a),l=d(t,a);return f(e,s.substring(0,2),a)+1+i<f(r,s.substring(2,4),a)||(i?0<o-l-i:1<o-l-i)}},842:(t,e,r)=>{r.d(e,{e:()=>a});class n{constructor(){this.data={}}cachedDataToParsed(t){const e={};for(let r=0;r<2;r++)e[r]={},e[r].FEN=t.fen,"cp"in t.pvs[r]?(e[r].CP=t.pvs[r].cp,e[r].move=t.pvs[r].moves.split(" ")[0],e[r].cpOrMate="cp"):(e[r].CP=t.pvs[r].mate,e[r].move=t.pvs[r].moves.split(" ")[0],e[r].cpOrMate="mate"),e[r].depth=t.depth;return e}getEval(){return this.data[0].CP}sendMessage(t,e){const r="w"==e.split(" ")[1];if("info depth 0 score mate 0"==t)this.data[0]={move:-1,isCheckmated:!0,CP:r?1:-1,cpOrMate:"mate"},this.data[0].FEN=e,this.data[0].depth=123;else{const n=function(t){const e=t.match(/depth (\d+)/);return e?parseInt(e[1]):-1}(t),s=function(t){const e=t.match(/multipv\s(\d+)/);return e?parseInt(e[1]):null}(t),a=function(t){const e=t.match(/pv\s(\w{4})/);if(e)return e[1]}(t);if(a){const i=function(t,e){const r=t.match(/score cp (-?\d+)/),n=t.match(/score mate (-?\d+)/);return r?{value:parseInt(r[1]),cpOrMate:"cp",isWhiteMove:e}:n?{value:parseInt(n[1]),cpOrMate:"mate",isWhiteMove:e}:void 0}(t,r);this.data[s-1]={move:a,CP:i.value*(r?1:-1),cpOrMate:i.cpOrMate},this.data[s-1].FEN=e,this.data[s-1].depth=n}}}getAllData(){return this.data}clearData(){this.data={}}}var s=r(735);async function a(t){var e;await Stockfish().then((t=>{e=t}));const r=new i(e,t);return e.addMessageListener((t=>{r.handleMainMessage({from:"stockfish",message:t})})),r}class i{constructor(t,e){this.sendEvalAfterEveryMove=e,this.stockfishWorker=t,this.stockfishParser=new n,this.moveTimeLengthMs=e?1e5:s.D.STOCKFISH_MOVETIME,this.isCurrentlyWorking=null,this.currentFEN=null,this.analysisOrchestrator=null,this.whiteMove=!0,this.stockfishWorker.postMessage("setoption name Hash value 512"),this.stockfishWorker.postMessage("setoption name Threads value 1"),this.stockfishWorker.postMessage("setoption name MultiPV value 2"),self.onmessage=this.handleMainMessage.bind(this)}async getLichessData(t){return[!1]}async checkCache(t){const e=await this.getLichessData(t);return 1==e[0]?[!0,this.stockfishParser.cachedDataToParsed(e[1])]:[!1]}deleteWorker(){this.stockfishWorker.terminate()}clearData(){this.stockfishWorker.postMessage("stop"),this.stockfishParser.clearData(),this.whiteMove=!0,this.isCurrentlyWorking=!1}setCallback(t){this.callbackFunction=t}fillRestOfDataForAnalysisOrchestrator(t){var e={};return e.positionEvaluation=t,e.FENstring=this.currentFEN,e.regularMove=this.currentRegularMove,e.moveIndex=this.moveIndex,e}async getAnalsysForFenPosition(t,e,r){this.currentFEN=t,this.currentRegularMove=e,this.moveIndex=r;const n=await this.checkCache(t);if(1==n[0])return this.callbackFunction(this.fillRestOfDataForAnalysisOrchestrator(n[1])),void(this.isCurrentlyWorking=!1);this.stockfishWorker.postMessage(`position fen ${t}`),this.stockfishWorker.postMessage(`go movetime ${this.moveTimeLengthMs}`)}async waitForRun(t,e,r){for(;this.isCurrentlyWorking;)await new Promise((t=>setTimeout(t,100)));this.isCurrentlyWorking=!0,await this.getAnalsysForFenPosition(t,e,r)}async stopAndStartNewAnalysis(t){this.stockfishWorker.postMessage("stop"),this.getAnalsysForFenPosition(t,"",0)}handleMainMessage(t){t.from;const e=t.message;if(e.startsWith("bestmove")){this.whiteMove=!this.whiteMove;const t=this.stockfishParser.getAllData();var r=this.fillRestOfDataForAnalysisOrchestrator(t);this.stockfishParser.clearData(),this.sendEvalAfterEveryMove||this.callbackFunction(r),this.isCurrentlyWorking=!1}else{this.stockfishParser.sendMessage(e,this.currentFEN);const t=this.stockfishParser.getAllData();this.sendEvalAfterEveryMove&&this.callbackFunction(this.fillRestOfDataForAnalysisOrchestrator(t))}}}},392:(t,e,r)=>{r.a(t,(async(t,n)=>{try{r.d(e,{W3:()=>l,dF:()=>h,mY:()=>c,wV:()=>o});var s=r(824),a=r(618),i=t([s]);function o(t,e){const r=(0,a.qQ)();r.load(e);const n=r.move({from:t.substring(0,2),to:t.substring(2,4),promotion:"q"});return n?n.san:t}s=(i.then?(await i)():i)[0];const l={draggable:!0,position:"start",onDragStart:u,onDrop:f};function c(t,e,r){return Math.min(Math.max(t,e),r)}function h(t){return t[0].charCodeAt(0)-"a".charCodeAt(0)}function u(t){var e=null;e=s.tQ.getInAlternative?s.tQ.getAlternativeChessObject():s.tQ.getChessObject();const r=s.sV.getChessboard();return!e.game_over()&&(!("w"===e.turn()&&(n=t.piece,!/^w/.test(n)))&&(!("b"===e.turn()&&!d(t.piece))&&void e.moves({square:t.square,verbose:!0}).forEach((t=>{r.addCircle(t.to)}))));var n}function d(t){return/^b/.test(t)}function f(t){if(!("wP"==t.piece&&"8"==t.target[1]||"bP"==t.piece&&"1"==t.target[1]))return p(t.source,t.target,"q");{const e=s.tQ.getChessObject();console.log(e.fen());const r=e.move({from:t.source,to:t.target,promotion:"q"});if(e.undo(),!r)return console.log("SNAP"),"snapback";{console.log("PROMOCIJA");const e=t.piece[0];s.sV.createPromotionPopup(p,t.source,t.target,e)}}}function p(t,e,r){return console.log("P"),s.sV.getChessboard(),s.tQ.getChessObject(),s.tQ.makePossibleAlternativeMove(t+e,r)}n()}catch(v){n(v)}}))}},a={};function i(t){var e=a[t];if(void 0!==e)return e.exports;var r=a[t]={exports:{}};return s[t](r,r.exports,i),r.exports}t="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",e="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",r="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",n=t=>{t&&t.d<1&&(t.d=1,t.forEach((t=>t.r--)),t.forEach((t=>t.r--?t.r++:t())))},i.a=(s,a,i)=>{var o;i&&((o=[]).d=-1);var l,c,h,u=new Set,d=s.exports,f=new Promise(((t,e)=>{h=e,c=t}));f[e]=d,f[t]=t=>(o&&t(o),u.forEach(t),f.catch((t=>{}))),s.exports=f,a((s=>{var a;l=(s=>s.map((s=>{if(null!==s&&"object"==typeof s){if(s[t])return s;if(s.then){var a=[];a.d=0,s.then((t=>{i[e]=t,n(a)}),(t=>{i[r]=t,n(a)}));var i={};return i[t]=t=>t(a),i}}var o={};return o[t]=t=>{},o[e]=s,o})))(s);var i=()=>l.map((t=>{if(t[r])throw t[r];return t[e]})),c=new Promise((e=>{(a=()=>e(i)).r=0;var r=t=>t!==o&&!u.has(t)&&(u.add(t),t&&!t.d&&(a.r++,t.push(a)));l.map((e=>e[t](r)))}));return a.r?c:i()}),(t=>(t?h(f[r]=t):c(d),n(o)))),o&&o.d<0&&(o.d=0)},i.d=(t,e)=>{for(var r in e)i.o(e,r)&&!i.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i(824)})();